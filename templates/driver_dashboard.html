<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Drowsiness and Yawn Detection System</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <style>
      body {
        background-color: #f8f9fa;
        font-family: "Roboto", sans-serif;
      }
      .navbar {
        background-color: #343a40;
      }
      .navbar-brand {
        color: #fff;
        font-weight: bold;
      }
      .card {
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
        transition: 0.3s;
        border-radius: 10px;
      }
      .card:hover {
        box-shadow: 0 8px 16px 0 rgba(0, 0, 0, 0.2);
      }
      .alert {
        border-radius: 10px;
      }
    </style>
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
      <a class="navbar-brand" href="#">Drowsiness and Yawn Detection</a>
      <button
        class="navbar-toggler"
        type="button"
        data-toggle="collapse"
        data-target="#navbarNav"
        aria-controls="navbarNav"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link" href="#">Logout</a>
          </li>
        </ul>
      </div>
    </nav>

    <div class="container my-4">
      <div class="row">
        <div class="col-md-8">
          <!-- Dashboard -->
          <div class="card mb-4">
            <div class="card-body">
              <h5 class="card-title">Dashboard</h5>
              <p class="card-text">
                System Status: <span class="badge badge-success">Active</span>
              </p>
              <button class="btn btn-primary" onclick="toggleMonitoring()">
                Start Monitoring
              </button>
            </div>
          </div>

          <!-- Alert History -->
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Alert History</h5>
              {% for alert in alerts %}
              <div class="alert alert-warning" role="alert">
                {{ alert.alert_type }} - {{ alert.timestamp }} {% if
                alert.description %}
                <br />
                {{ alert.description }} {% endif %}
              </div>
              {% empty %}
              <p>No alerts yet.</p>
              {% endfor %}
            </div>
          </div>
        </div>

        <div class="col-md-4">
          <!-- Notifications -->
          <div class="card mb-4">
            <div class="card-body">
              <h5 class="card-title">Notifications</h5>
              <div class="alert alert-danger" role="alert">
                Drowsiness detected! Take a break.
              </div>
            </div>
          </div>

          <!-- Settings -->
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Settings</h5>
              <form method="post" action="{% url 'update_settings' %}">
                {% csrf_token %}
                <div class="form-group">
                  <label for="sensitivity">Sensitivity</label>
                  <input
                    type="range"
                    class="form-control-range"
                    id="sensitivity"
                    name="ear_threshold"
                    min="0.1"
                    max="0.5"
                    step="0.05"
                    value="{{ user_settings.ear_threshold }}"
                  />
                </div>
                <div class="form-group">
                  <label for="ear_frames">Consecutive Frames</label>
                  <input
                    type="number"
                    class="form-control"
                    id="ear_frames"
                    name="ear_frames"
                    min="10"
                    max="60"
                    value="{{ user_settings.ear_frames }}"
                  />
                </div>
                <div class="form-group">
                  <label for="yawn_threshold">Yawn Threshold</label>
                  <input
                    type="number"
                    class="form-control"
                    id="yawn_threshold"
                    name="yawn_threshold"
                    min="10"
                    max="50"
                    value="{{ user_settings.yawn_threshold }}"
                  />
                </div>
                <div class="form-group">
                  <label for="alertFrequency">Alert Frequency</label>
                  <select class="form-control" id="alertFrequency" name="alert_frequency">
                    <option value="low" {% if user_settings.alert_frequency == 'low' %}selected{% endif %}>Low</option>
                    <option value="medium" {% if user_settings.alert_frequency == 'medium' %}selected{% endif %}>Medium</option>
                    <option value="high" {% if user_settings.alert_frequency == 'high' %}selected{% endif %}>High</option>
                  </select>
                </div>
                <button type="submit" class="btn btn-primary">Save Settings</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
      function toggleMonitoring() {
        // Send an AJAX request to the server to start/stop monitoring
        fetch("{% url 'toggle_monitoring' %}", {
          method: "POST",
          headers: {
            "X-CSRFToken": "{{ csrf_token }}",
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            action: event.target.innerText.toLowerCase().includes("start")
              ? "start"
              : "stop",
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            // Update the button text based on the action
            event.target.innerText =
              data.action === "start"
                ? "Stop Monitoring"
                : "Start Monitoring";
    
            // Display a success message
            alert(data.message);
          })
          .catch((error) => {
            console.error("Error:", error);
          });
      }
    </script>
  </body>
</html>
